<!DOCTYPE html>
<html lang="tr">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	    <title>Hafıza Taşları 🧠</title>
    
    <!-- Vercel Analytics -->
    <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
    
    <style>
		/* Hafıza Taşları — tek dosya HTML+CSS+JS */
		* { box-sizing: border-box; margin: 0; padding: 0; }
		body {
			font-family: 'Trebuchet MS', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
			min-height: 100vh;
			background: linear-gradient(135deg, #86efac 0%, #a5b4fc 100%);
			color: #0f172a;
			padding: 18px;
		}
		.container {
			max-width: 1000px;
			margin: 0 auto;
			background: #ffffffee;
			border: 1px solid #e2e8f0;
			border-radius: 16px;
			box-shadow: 0 18px 40px rgba(0,0,0,0.18);
			padding: 20px;
		}
		.header { text-align: center; margin-bottom: 12px; }
		.header h1 { font-size: 2.1rem; color: #1e293b; text-shadow: 0 1px 0 #fff; margin-bottom: 6px; }
		.subtitle { color: #475569; }

		.topbar { display: flex; gap: 10px; justify-content: space-between; align-items: center; flex-wrap: wrap; margin: 12px 0; }
		.badges { display: flex; gap: 8px; flex-wrap: wrap; }
		.badge { background: #ecfeff; border: 1px solid #bae6fd; color: #0c4a6e; padding: 8px 12px; border-radius: 999px; font-weight: 800; }
		.controls { display: flex; gap: 8px; flex-wrap: wrap; }
		.btn { padding: 10px 14px; border-radius: 10px; border: 1px solid #cbd5e1; background: #fff; color: #0f172a; font-weight: 800; cursor: pointer; }
		.btn:hover { box-shadow: 0 6px 16px rgba(0,0,0,0.08); transform: translateY(-1px); }
		.btn-primary { background: linear-gradient(180deg, #60a5fa, #3b82f6); color: #fff; border: 1px solid #3b82f6; }
		.btn-warning { background: linear-gradient(180deg, #fbbf24, #f59e0b); color: #fff; border: 1px solid #f59e0b; }
		.btn-danger { background: linear-gradient(180deg, #f87171, #ef4444); color: #fff; border: 1px solid #ef4444; }
		.btn:disabled { opacity: 0.6; cursor: not-allowed; }

		.stage { display: grid; grid-template-columns: 1fr 280px; gap: 14px; }
		@media (max-width: 840px) { .stage { grid-template-columns: 1fr; } }

		.board-wrap { display: flex; flex-direction: column; align-items: center; gap: 10px; }
		.board {
			display: grid;
			gap: 6px;
			background: #e2e8f0;
			padding: 10px;
			border-radius: 12px;
			border: 1px solid #cbd5e1;
			box-shadow: inset 0 0 12px rgba(0,0,0,0.06);
			--cell: 64px; /* dinamik olarak değişecek */
		}
		.tile {
			width: var(--cell);
			height: var(--cell);
			border-radius: 12px;
			border: 2px solid #94a3b8;
			background: linear-gradient(180deg, #1e293b, #0f172a);
			cursor: pointer;
			transition: transform .12s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
			position: relative;
			outline: none;
		}
		.tile:focus { box-shadow: 0 0 0 3px rgba(59,130,246,0.4); }
		.tile.show {
			background: linear-gradient(180deg, #fde68a, #f59e0b);
			border-color: #f59e0b;
			box-shadow: 0 0 22px rgba(245, 158, 11, 0.6);
		}
		.tile.correct {
			background: linear-gradient(180deg, #86efac, #22c55e);
			border-color: #16a34a;
			box-shadow: 0 0 20px rgba(34,197,94,0.55);
		}
		.tile.wrong {
			animation: shake .25s ease-in-out;
			box-shadow: 0 0 14px rgba(239,68,68,0.6);
		}
		@keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-3px)} 75%{transform:translateX(3px)} }

		.sidebar { display: flex; flex-direction: column; gap: 10px; }
		.panel { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 12px; }
		.panel h3 { margin-bottom: 8px; color: #0f172a; font-size: 1rem; }
		.status { text-align: center; font-weight: 800; padding: 10px; border-radius: 10px; }
		.status.ready { background: #dcfce7; color: #14532d; }
		.status.showing { background: #fff7ed; color: #7c2d12; }
		.status.guess { background: #e0f2fe; color: #075985; }
		.status.success { background: #dbeafe; color: #1e3a8a; }
		.status.fail { background: #fee2e2; color: #7f1d1d; }

		.footer { text-align: center; color: #334155; margin-top: 12px; }
		.footer a { color: #1e3a8a; font-weight: 800; text-decoration: none; }
	</style>
</head>
<body>
	<div class="container">
		<div class="header">
			<h1>🧠 Hafıza Taşları</h1>
			<div class="subtitle">Bazı taşlar 3 saniyeliğine yanacak. Hepsi sönince aynı taşlara sırayla bas. Hepsini doğru bulursan seviye artar ve tahta büyür!</div>
		</div>

		<div class="topbar" aria-live="polite">
			<div class="badges">
				<span id="level-badge" class="badge">Seviye: 1</span>
				<span id="score-badge" class="badge">Puan: 0</span>
				<span id="miss-badge" class="badge">Yanlış: 0/3</span>
			</div>
			<div class="controls">
				<button id="new-btn" class="btn btn-primary" aria-label="Yeni oyun başlat">🆕 Yeni Oyun</button>
				<button id="replay-btn" class="btn" aria-label="Kısa tekrar göster">👀 Tekrar Göster</button>
				<button id="reset-btn" class="btn btn-warning" aria-label="Aynı seviyeyi sıfırla">↩️ Sıfırla</button>
				<a href="index.html" class="btn btn-danger" aria-label="Ana sayfa">🏠 Ana Sayfa</a>
			</div>
		</div>

		<div class="stage">
			<div class="board-wrap">
				<div id="board" class="board" role="grid" aria-label="Hafıza tahtası"></div>
				<div id="status" class="status ready">Hazır</div>
			</div>
			<div class="sidebar">
				<div class="panel">
					<h3>📘 Nasıl Oynanır</h3>
					<p>Taşlar kısa süre yanacak, sonra sönecek. Hangi taşların yandığını aklında tut ve hepsini doğru işaretle. Tümünü bulursan seviye artar ve tahta 1 büyür. 8x8 sonrası hücre boyutu otomatik küçülür.</p>
				</div>
				<div class="panel">
					<h3>⚙️ Ayarlar</h3>
					<p>Yanma süresi: 3s. Yanlış limiti: 3. “Tekrar Göster” her turda 1 kez kullanılır (1.5s).</p>
				</div>
			</div>
		</div>

		<div class="footer">Başarılar! Dikkatini topla ve hafızanı test et.</div>
	</div>

	<script>
		// Oyun durumu
		const game = {
			level: 1,
			size: 3,
			score: 0,
			mistakes: 0,
			maxMistakes: 3,
			showMs: 3000,
			showing: false,
			allowReplay: true,
			targets: new Set(), // "x,y"
			found: new Set(),
		};

		// Yardımcılar
		const $ = (id) => document.getElementById(id);
		const delay = (ms) => new Promise(r => setTimeout(r, ms));
		function key(x,y){ return `${x},${y}`; }
		function unkey(k){ const [x,y]=k.split(',').map(Number); return {x,y}; }
		function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
		function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

		// Dinamik hücre boyutu: 8x8 sonrası küçült
		function computeCell(size){
			const px = Math.floor(520 / size); // hedef genişlik ~520px
			return clamp(px, 24, 64) + 'px';
		}

		function updateBadges(){
			$('level-badge').textContent = `Seviye: ${game.level}`;
			$('score-badge').textContent = `Puan: ${game.score}`;
			$('miss-badge').textContent = `Yanlış: ${game.mistakes}/${game.maxMistakes}`;
		}
		function setStatus(kind, text){
			const s = $('status'); s.className = `status ${kind}`; s.textContent = text;
		}
		function disableControls(b){
			$('new-btn').disabled = b; $('reset-btn').disabled = b; $('replay-btn').disabled = b || !game.allowReplay;
		}

		function targetsCountBySize(size){
			const base = Math.ceil(size * 1.5);
			const bonus = Math.max(0, size - 8);
			const t = base + bonus;
			return Math.min(t, size*size - 1);
		}

		function nextSize(level){ return 3 + (level - 1); }

		function renderBoard(){
			const board = $('board');
			board.innerHTML = '';
			board.style.setProperty('--cell', computeCell(game.size));
			board.style.gridTemplateColumns = `repeat(${game.size}, var(--cell))`;
			board.style.gridTemplateRows = `repeat(${game.size}, var(--cell))`;
			for (let y=0;y<game.size;y++){
				for (let x=0;x<game.size;x++){
					const btn = document.createElement('button');
					btn.type = 'button';
					btn.className = 'tile';
					btn.id = `tile-${x}-${y}`;
					btn.setAttribute('aria-label', `Taş ${x+1}, ${y+1}`);
					btn.addEventListener('click', ()=>onTileClick(x,y));
					board.appendChild(btn);
				}
			}
		}

		function clearClasses(x,y){
			const el = $(`tile-${x}-${y}`); if (!el) return;
			el.classList.remove('show','correct','wrong');
		}
		function markShow(x,y){ const el = $(`tile-${x}-${y}`); if (el) el.classList.add('show'); }
		function markCorrect(x,y){ const el = $(`tile-${x}-${y}`); if (el) el.classList.add('correct'); }
		function markWrong(x,y){ const el = $(`tile-${x}-${y}`); if (el){ el.classList.add('wrong'); setTimeout(()=>el.classList.remove('wrong'), 280);} }

		function pickTargets(){
			game.targets.clear();
			game.found.clear();
			const need = targetsCountBySize(game.size);
			while (game.targets.size < need){
				const x = rand(0, game.size-1), y = rand(0, game.size-1);
				game.targets.add(key(x,y));
			}
		}

		async function showSequence(ms){
			game.showing = true; disableControls(true); setStatus('showing', `Gösteriliyor… (${Math.round(ms/1000)})`);
			// Tüm hedefleri aydınlat
			for (const k of game.targets){ const {x,y} = unkey(k); markShow(x,y); }
			await delay(ms);
			// Hepsini söndür
			for (const k of game.targets){ const {x,y} = unkey(k); clearClasses(x,y); }
			game.showing = false; disableControls(false); setStatus('guess', 'Tahmin zamanı!');
		}

		async function replayHint(){
			if (!game.allowReplay || game.showing) return;
			game.allowReplay = false; disableControls(false);
			// Kısa tekrar 1.5s
			for (const k of game.targets){ const {x,y} = unkey(k); markShow(x,y); }
			await delay(1500);
			for (const k of game.targets){ const {x,y} = unkey(k); clearClasses(x,y); }
			setStatus('guess', 'Tahmin zamanı! (Tekrar göster kullanıldı)');
		}

		function onTileClick(x,y){
			if (game.showing) return; // gösterimde tıklama yok
			const k = key(x,y);
			if (game.found.has(k)) return; // tekrar sayma
			if (game.targets.has(k)){
				game.found.add(k); markCorrect(x,y); game.score += 1; updateBadges();
				checkRoundEnd();
			} else {
				game.mistakes += 1; updateBadges(); markWrong(x,y);
				if (game.mistakes >= game.maxMistakes){
					setStatus('fail', 'Üzgünüm, tekrar dene');
					disableControls(false);
				}
			}
		}

		function checkRoundEnd(){
			if (game.found.size === game.targets.size){
				setStatus('success', `Tebrikler! Seviye ${game.level+1} 🎉`);
				// küçük bonus: boyut kadar puan
				game.score += game.size; updateBadges();
				// sonraki seviyeye geç
				setTimeout(()=>levelUp(), 900);
			}
		}

		function levelUp(){
			game.level += 1;
			game.size = nextSize(game.level); // 3x3'ten başlayarak +1 artar
			startLevel();
		}

		function resetLevel(){ startLevel(); }
		function newGame(){ game.level = 1; game.size = 3; game.score = 0; startLevel(); }

		async function startLevel(){
			game.mistakes = 0; game.allowReplay = true; game.targets.clear(); game.found.clear(); updateBadges();
			renderBoard(); pickTargets(); setStatus('ready', 'Hazır');
			await delay(300); // küçük nefes
			await showSequence(game.showMs);
		}

		// Bağlantılar
		document.addEventListener('DOMContentLoaded', ()=>{
			$('new-btn').addEventListener('click', newGame);
			$('reset-btn').addEventListener('click', resetLevel);
			$('replay-btn').addEventListener('click', replayHint);
			newGame();
		});

		// Klavye ile gezinme (erişilebilirlik): oklar ve boşluk/enter
		document.addEventListener('keydown', (e)=>{
			const active = document.activeElement;
			if (!active || !active.id || !active.id.startsWith('tile-')) return;
			const parts = active.id.split('-');
			const x = parseInt(parts[1],10), y = parseInt(parts[2],10);
			let nx=x, ny=y;
			if (e.key==='ArrowUp'){ ny = Math.max(0, y-1); }
			else if (e.key==='ArrowDown'){ ny = Math.min(game.size-1, y+1); }
			else if (e.key==='ArrowLeft'){ nx = Math.max(0, x-1); }
			else if (e.key==='ArrowRight'){ nx = Math.min(game.size-1, x+1); }
			else if (e.key==='Enter' || e.key===' '){ onTileClick(x,y); e.preventDefault(); return; }
			if (nx!==x || ny!==y){ const next = $(`tile-${nx}-${ny}`); if (next) next.focus(); e.preventDefault(); }
		});
	</script>
</body>
</html>
