<!DOCTYPE html>
<html lang="tr">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Çarpım Kahramanı 🔢</title>
	<style>
		* { box-sizing: border-box; margin: 0; padding: 0; }
		body {
			font-family: 'Trebuchet MS', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
			min-height: 100vh;
			background: linear-gradient(135deg, #f59e0b 0%, #f43f5e 40%, #8b5cf6 100%);
			background-attachment: fixed;
			color: #0f172a;
			padding: 20px;
		}

		.container {
			max-width: 1000px;
			margin: 0 auto;
			background: #ffffffee;
			border-radius: 16px;
			box-shadow: 0 20px 50px rgba(0,0,0,0.25);
			border: 1px solid #e2e8f0;
			padding: 22px;
		}

		.header { text-align: center; margin-bottom: 12px; }
		.header h1 { font-size: 2.2rem; color: #1f2937; text-shadow: 0 1px 0 #fff; margin-bottom: 6px; }
		.subtitle { color: #475569; }

		.topbar { display: flex; gap: 10px; justify-content: space-between; align-items: center; flex-wrap: wrap; margin: 12px 0; }
		.badges { display: flex; gap: 8px; flex-wrap: wrap; }
		.badge { background: #eef2ff; border: 1px solid #c7d2fe; color: #3730a3; padding: 8px 12px; border-radius: 999px; font-weight: 800; }
		#time-badge { background: linear-gradient(45deg, #f43f5e, #f59e0b); color: #ffffff; border-color: rgba(0,0,0,0.08); box-shadow: inset 0 0 0 3px rgba(255,255,255,0.25), 0 0 18px rgba(249,115,22,0.35); animation: pulse 1.4s infinite; }
		.controls { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
		select, button { padding: 10px 12px; border-radius: 10px; border: 1px solid #cbd5e1; background: #fff; color: #0f172a; }
		button { font-weight: 800; cursor: pointer; transition: transform .1s ease, box-shadow .2s ease; }
		button:hover { transform: translateY(-1px); box-shadow: 0 8px 18px rgba(0,0,0,0.08); }
		.btn-primary { background: linear-gradient(180deg, #34d399, #10b981); color: #fff; border: 1px solid #10b981; }
		.btn-warning { background: linear-gradient(180deg, #fbbf24, #f59e0b); color: #fff; border: 1px solid #f59e0b; }
		.btn-danger { background: linear-gradient(180deg, #f87171, #ef4444); color: #fff; border: 1px solid #ef4444; }

		.arena { display: grid; grid-template-columns: 1fr; gap: 12px; }
		.board { display: grid; gap: 12px; grid-template-columns: 1fr; align-items: center; justify-items: center; }
		.question {
			background: linear-gradient(135deg, #a7f3d0, #6ee7b7);
			border: 2px solid #10b981; color: #064e3b; border-radius: 16px; padding: 16px; width: 100%; text-align: center;
			box-shadow: inset 0 0 18px rgba(16,185,129,0.15);
		}
		.q-text { font-size: 2.6rem; font-weight: 900; letter-spacing: 1px; }
		.round { margin-top: 6px; font-weight: 800; color: #065f46; }

		.answers { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; width: 100%; }
		.answer {
			padding: 16px; border-radius: 14px; border: 2px solid #e2e8f0; background: #fff; font-size: 1.4rem; font-weight: 900;
			cursor: pointer; text-align: center; user-select: none; outline: none; position: relative;
			transition: transform .1s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
		}
		.answer:hover { transform: translateY(-1px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
		.answer.correct { background: linear-gradient(180deg, #d1fae5, #a7f3d0); border-color: #10b981; }
		.answer.wrong { background: linear-gradient(180deg, #fee2e2, #fecaca); border-color: #ef4444; }
		.shake { animation: shake .25s ease-in-out; }
		@keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-4px)} 75%{transform:translateX(4px)} }

		.status { text-align: center; font-weight: 800; padding: 10px; border-radius: 10px; }
		.status.ready { background: #e0f2fe; color: #075985; }
		.status.running { background: #fef9c3; color: #854d0e; }
		.status.success { background: #d1fae5; color: #065f46; }
		.status.fail { background: #fee2e2; color: #7f1d1d; }

		.footer { text-align: center; color: #334155; margin-top: 12px; }
		.footer a { color: #1e3a8a; font-weight: 800; text-decoration: none; }

		/* Mini konfeti noktaları */
		.confetti { pointer-events: none; position: absolute; inset: 0; overflow: hidden; }
		.dot { position: absolute; width: 8px; height: 8px; border-radius: 50%; opacity: 0; animation: pop 800ms ease-out forwards; }
		@keyframes pop { 0%{transform:translateY(0) scale(0.2); opacity:0} 30%{opacity:1} 100%{transform:translateY(-80px) scale(1); opacity:0} }

		/* Responsive */
		@media (max-width: 640px) {
			.q-text { font-size: 2.2rem; }
			.answers { grid-template-columns: 1fr; }
		}

		/* Mobilde sistem fontu */
		@media (max-width: 768px) {
			body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="header">
			<h1>🔢 Çarpım Kahramanı</h1>
			<div class="subtitle">Renkli çoktan seçmeli sorular ile çarpım tablosunu ezberle!</div>
		</div>

		<div class="topbar" aria-live="polite">
			<div class="badges">
				<span id="score-badge" class="badge">Puan: 0</span>
				<span id="streak-badge" class="badge">Seri: 0🔥</span>
				<span id="best-badge" class="badge">Rekor Seri: 0</span>
				<span id="lives-badge" class="badge">❤️❤️❤️</span>
				<span id="time-badge" class="badge">Süre: 0.0s</span>
			</div>
			<div class="controls">
				<label for="mode">Seviye</label>
				<select id="mode" aria-label="Seviye seç">
					<option value="learn" selected>Yeni öğreniyorum (15s)</option>
					<option value="know">Ben biliyorum (5s)</option>
				</select>
				<label for="table">Tablo</label>
				<select id="table" aria-label="Tablo seç">
					<option value="mix" selected>Karışık (2-10)</option>
					<option value="2">2'ler</option>
					<option value="3">3'ler</option>
					<option value="4">4'ler</option>
					<option value="5">5'ler</option>
					<option value="6">6'lar</option>
					<option value="7">7'ler</option>
					<option value="8">8'ler</option>
					<option value="9">9'lar</option>
					<option value="10">10'lar</option>
				</select>
				<button id="new-btn" class="btn-primary">🆕 Yeni Tur</button>
				<button id="reset-btn" class="btn-warning">↩️ Sıfırla</button>
				<a class="btn-danger" href="index.html" aria-label="Ana sayfa">🏠 Ana Sayfa</a>
			</div>
		</div>

		<div class="arena">
			<div class="board">
				<div class="question">
					<div id="q-text" class="q-text">Hazır mısın?</div>
					<div id="round" class="round">Tur: 0 / 10</div>
				</div>
				<div class="answers" id="answers" role="group" aria-label="Cevap seçenekleri"></div>
				<div id="status" class="status ready">🟢 Hazır — 1–4 tuşlarıyla da cevap verebilirsin.</div>
				<div class="confetti" id="confetti"></div>
			</div>
		</div>

		<div class="footer">İpucu: Serini koru, puanın katlansın! 🎉</div>
	</div>

	<script>
		const $ = (id) => document.getElementById(id);
		const delay = (ms) => new Promise(r => setTimeout(r, ms));
		function rand(min, max){ return Math.floor(Math.random() * (max - min + 1)) + min; }
		function shuffle(arr){ for (let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }

		const game = {
			round: 0,
			maxRounds: 10,
			score: 0,
			streak: 0,
			bestStreak: 0,
			lives: 3,
			current: null, // {a,b,correct,options:[...]}
		};

		function updateBadges(){
			$('score-badge').textContent = `Puan: ${game.score}`;
			$('streak-badge').textContent = `Seri: ${game.streak}🔥`;
			$('best-badge').textContent = `Rekor Seri: ${game.bestStreak}`;
			$('lives-badge').textContent = '❤️'.repeat(game.lives) + '🤍'.repeat(Math.max(0, 3 - game.lives));
		}

		function setStatus(kind, text){ const s=$('status'); s.className = `status ${kind}`; s.textContent = text; }

		function pickA(){
			const t = $('table').value;
			if (t === 'mix') return rand(2, 10);
			return parseInt(t, 10);
		}

		function generateQuestion(){
			const a = pickA();
			const b = rand(2, 10);
			const correct = a * b;
			const options = new Set([correct]);
			while (options.size < 4){
				// yakındaki sayılardan ve karışık sapmalardan üret
				const delta = [ -10,-9,-7,-5,-3,-2,-1,1,2,3,5,7,9,10 ][rand(0,13)];
				const guess = Math.max(0, correct + delta * (rand(0,1)?1:-1));
				if (guess !== correct && guess <= 10*10) options.add(guess);
			}
			const picked = shuffle(Array.from(options));
			return { a, b, correct, options: picked };
		}

		function renderQuestion(){
			const q = game.current;
			$('q-text').textContent = `${q.a} × ${q.b} = ?`;
			$('round').textContent = `Tur: ${game.round} / ${game.maxRounds}`;
			const answers = $('answers');
			answers.innerHTML = '';
			q.options.forEach((val, idx) => {
				const btn = document.createElement('button');
				btn.type = 'button'; btn.className = 'answer'; btn.setAttribute('data-val', String(val));
				btn.setAttribute('aria-label', `Cevap: ${val}`);
				btn.textContent = String(val);
				btn.addEventListener('click', () => onAnswer(val, btn));
				answers.appendChild(btn);
			});
		}

		let timerId = null; let timeLeftMs = 0; let awaitingAnswer = false;
		function getBaseTimeMs(){
			const m = $('mode').value; return m === 'know' ? 5000 : 15000;
		}

		function updateTimeBadge(){ $('time-badge').textContent = `Süre: ${(timeLeftMs/1000).toFixed(1)}s`; }
		function stopTimer(){ if (timerId){ clearInterval(timerId); timerId = null; } }
		function startTimer(ms){
			timeLeftMs = ms; updateTimeBadge(); stopTimer();
			timerId = setInterval(()=>{
				timeLeftMs = Math.max(0, timeLeftMs - 100);
				updateTimeBadge();
				if (timeLeftMs <= 0){ stopTimer(); if (awaitingAnswer) onTimeout(); }
			}, 100);
		}

		let firstRoundArmed = false;
		function armFirstTimer(ms){
			if (firstRoundArmed) return; firstRoundArmed = true;
			const answers = $('answers');
			const start = () => { if (!timerId && awaitingAnswer){ startTimer(ms); } detach(); };
			const keyStart = (e) => { if (['1','2','3','4'].includes(e.key)) { if (!timerId && awaitingAnswer){ startTimer(ms); } detach(); } };
			function detach(){ answers.removeEventListener('pointerdown', start); document.removeEventListener('keydown', keyStart); }
			answers.addEventListener('pointerdown', start, { once: true });
			document.addEventListener('keydown', keyStart, { once: true });
		}

		async function onTimeout(){
			awaitingAnswer = false;
			const q = game.current; if (!q) return;
			const nodes = Array.from(document.querySelectorAll('.answer'));
			nodes.forEach(n => n.disabled = true);
			setStatus('fail', '⏰ Süre doldu! Hızlı hesap makineleri sahnede, ama sen daha hızlı olabilirsin!');
			// doğru cevabı vurgula
			nodes.forEach(n => { if (parseInt(n.getAttribute('data-val')||'0',10) === q.correct){ n.classList.add('correct'); }});
			game.streak = 0; game.lives = Math.max(0, game.lives - 1); updateBadges();
			if (game.lives === 0){ return; }
			await delay(700);
			nextRound();
		}

		function nextRound(){
			if (game.round >= game.maxRounds){
				setStatus('success', `Tebrikler! Tur bitti 🎉 — Puan: ${game.score}, Rekor Seri: ${game.bestStreak}`);
				confettiBurst();
				return;
			}
			game.round += 1;
			game.current = generateQuestion();
			renderQuestion();
			setStatus('running', 'Soru hazır — 1–4 ile cevapla.');
			awaitingAnswer = true; timeLeftMs = 0; updateTimeBadge();
			const base = getBaseTimeMs();
			if (game.round === 1){ armFirstTimer(base); }
			else { startTimer(base); }
		}

		function confettiBurst(){
			const root = $('confetti');
			for (let i=0;i<30;i++){
				const d = document.createElement('div');
				d.className = 'dot';
				d.style.left = rand(10, 90) + '%';
				d.style.bottom = '10%';
				d.style.background = ['#f43f5e','#f97316','#22c55e','#3b82f6','#a855f7','#eab308'][rand(0,5)];
				d.style.animationDelay = (i*10) + 'ms';
				root.appendChild(d);
				setTimeout(()=> d.remove(), 900);
			}
		}

		async function onAnswer(val, btn){
			const q = game.current; if (!q) return;
			const nodes = Array.from(document.querySelectorAll('.answer'));
			nodes.forEach(n => n.disabled = true);
			awaitingAnswer = false; stopTimer();
			if (val === q.correct){
				btn.classList.add('correct');
				game.streak += 1; game.bestStreak = Math.max(game.bestStreak, game.streak);
				const bonus = 1 + Math.floor(Math.max(0, game.streak - 1) / 3); // her 3 seride +1 bonus
				game.score += bonus;
				updateBadges();
				confettiBurst();
				await delay(450);
				nextRound();
			} else {
				btn.classList.add('wrong');
				btn.classList.add('shake');
				game.streak = 0; game.lives = Math.max(0, game.lives - 1); updateBadges();
				// doğru cevabı vurgula
				nodes.forEach(n => { if (parseInt(n.getAttribute('data-val')||'0',10) === q.correct){ n.classList.add('correct'); }});
				if (game.lives === 0){ setStatus('fail', 'Üzgünüm, canların bitti 😢 — Yeni tur ile tekrar dene!'); return; }
				await delay(650);
				nextRound();
			}
		}

		function resetGame(){
			game.round = 0; game.score = 0; game.streak = 0; game.bestStreak = 0; game.lives = 3; game.current = null;
			$('answers').innerHTML = '';
			$('q-text').textContent = 'Hazır mısın?';
			$('round').textContent = 'Tur: 0 / 10';
			setStatus('ready', '🟢 Hazır — 1–4 tuşlarıyla da cevap verebilirsin.');
			stopTimer(); timeLeftMs = 0; updateTimeBadge();
			updateBadges();
		}

		function newRun(){ resetGame(); nextRound(); }

		document.addEventListener('DOMContentLoaded', ()=>{
			$('new-btn').addEventListener('click', newRun);
			$('reset-btn').addEventListener('click', resetGame);
			updateBadges();
			setStatus('ready', '🟢 Hazır — 1–4 tuşlarıyla da cevap verebilirsin.');
			// Sayfa yüklenince otomatik başla
			newRun();
		});

		// Klavye kısayolları 1-4
		document.addEventListener('keydown', (e)=>{
			if (['1','2','3','4'].includes(e.key)){
				const idx = parseInt(e.key, 10) - 1;
				const nodes = Array.from(document.querySelectorAll('.answer'));
				if (nodes[idx]) { nodes[idx].click(); e.preventDefault(); }
			}
		});
	</script>
</body>
</html>


